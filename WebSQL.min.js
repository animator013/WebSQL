(function(e){var t="0.2";var n=e.WebSQL=function(t,s,o,u,a){var f=e.openDatabase&&e.openDatabase(t,s,o||t,u||5e6,a),l=f&&{getVersion:function(){return f.version},query:function(e){var t=n.Deferred(),i=r(e)?e:arguments;l.rawTx(function(e){var s=n.Deferred(),o,u,a,f,l,c,h,p,d=s.reject;for(f=0,l=i.length;f<l;f++){o=i[f];u=i[f+1];if(typeof o==="function"){o=o.toString();o=o.substr(o.indexOf("/*!")+3);o=o.substr(0,o.lastIndexOf("*/"))}a=/^\s*(?:INSERT|REPLACE)\s+INTO\s+\w+\s*\(([^\)]+)\)\s*$/i.exec(o);if(a&&a[1]){o+=" VALUES ("+(new Array(a[1].split(",").length)).join("?,")+"?)"}if(r(u)){f+=1;if(r(u[0])){for(c=0,h=u.length;c<h;c++){if(f+1===l&&c+1===h){p=s.resolve}e.executeSql(o,u[c],p,d)}}else{if(f+1===l){p=s.resolve}e.executeSql(o,u,p,d)}}else{if(f+1===l){p=s.resolve}e.executeSql(o,[],p,d)}}s.fail(t.reject).done(function(e,n){var r=null,i,s;if(n){s=n.rows;if(s){r=[];for(i=0;i<s.length;i++){r[i]=s.item(i)}}if(r&&r.length===0){try{r.insertId=n.insertId}catch(o){r.insertId=null}}else{r.insertId=null}}t.resolve(r)})});return t.promise()},rawTx:function(e){f.transaction(e)},getTableNames:function(){var e=n.Deferred();l.query('SELECT tbl_name FROM sqlite_master WHERE type = "table" AND tbl_name NOT REGEXP "^(__|sqlite_).*"').fail(e.reject).done(function(t){var n,r=[];for(n=0;n<t.length;n++){r[n]=t[n].tbl_name}e.resolve(r)});return e.promise()},dump:function(e,t){var r=n.Deferred();t=t!==false;switch(e){case"json":default:l.query('SELECT * FROM sqlite_master WHERE tbl_name NOT REGEXP "^(__|sqlite_).*" ORDER BY CASE type WHEN "table" THEN 1 WHEN "index" THEN 2 ELSE 3 END').fail(r.reject).done(function(e){var i={},s=[],o,u;for(u=0;o=e[u];u++){if(!o.sql)continue;switch(o.type){case"table":i[o.tbl_name]={schema:{table:o.sql,indexes:[]}};if(t){(function(e){var t=n.Deferred();l.query("SELECT * FROM "+e).fail(t.reject).done(function(n){delete n.insertId;i[e].data=n;t.resolve()});s.push(t)})(o.tbl_name)}break;case"index":i[o.tbl_name].schema.indexes.push(o.sql);break}}n.when.apply(n,s).fail(r.reject).done(function(){r.resolve(i)})});break;case"sql":l.dump("json",t).fail(r.reject).done(function(e){var t=[],n,s,o,u,a,f,l;for(var c in e){if(!i(c,e))continue;n=e[c];t.push(n.schema.table);t=t.concat(n.schema.indexes);if(n.data&&n.data.length>0){a=[];s=n.data[0];for(u in s){if(!i(u,s))continue;a.push(/\s/.test(u)?"`"+u+"`":u)}a=a.join(", ");f=[];for(o=0;s=n.data[o];o++){f[o]=[];for(u in s){if(!i(u,s))continue;if(typeof s[u]==="number"){l=s[u]}else if(s[u]===null||s[u]===void null){l="NULL"}else{l='"'+s[u]+'"'}f[o].push(l)}f[o]="("+f[o].join(", ")+")"}f=f.join(",\n	");t.push("INSERT INTO "+c+" ("+a+") VALUES\n	"+f)}}t=t.join(";\n")+";";r.resolve(t)})}return r.promise()}};return l};n.VERSION=t;var r=Array.isArray||function(e){return!!(e&&e.constructor===Array)};var i=function(e,t){return Object.prototype.hasOwnProperty.call(t,e)}})(this);(function(e){e.Deferred=function(){var e,n=t(),r=t(),i={promise:function(){var e={};var t=function(t){return function(){t.apply(this,arguments);return e}};e.always=t(i.always);e.done=t(i.done);e.fail=t(i.fail);e.then=t(i.then);e.state=i.state;return e},state:function(){return e||"pending"},resolve:function(){if(!e){e="resolved";n.fire.apply(n,arguments)}return i},reject:function(){if(!e){e="rejected";r.fire.apply(r,arguments)}return i},always:function(e){return i.then(e,e)},done:function(e){n.add(e);return i},fail:function(e){r.add(e);return i},then:function(e,t){return i.done(e).fail(t)}};return i};e.when=function(t){var n,r=new Array(arguments.length),i=e.Deferred();for(n=0;n<arguments.length;n++){arguments[n].fail(function(){i.reject.apply(this,arguments);r=null})}if(arguments.length>0){for(n=0;n<arguments.length;n++){(function(e,t){t.done(function(){r[e]=arguments;for(var t=0;t<r.length;t++){if(r[t]===void null)break}if(t===r.length){i.resolve.apply(i,r)}})})(n,arguments[n])}}else{i.resolve.apply(i,r)}return i.promise()};var t=function(){var e=[],t,n={hasFired:function(){return!!t},add:function(r){e.push(r);if(n.hasFired()){n.fire.apply(n,t)}},fire:function(){t=arguments;for(var r=0;r<e.length;r++){e[r].apply(n,t)}e=[]}};return n}})(WebSQL)